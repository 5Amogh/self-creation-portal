<div class="main flex">
    <div class="w-full">
        <div color="secondary" class="border-b px-10 py-2">
            <span>Tasks</span>
        </div>
        <div class="px-10 my-5">
            <p>Break down the project into smaller tasks. Mandatory tasks cannot be edited or deleted by users and need
                to be marked as complete for project submission.</p>
        </div>
        <form [formGroup]="tasksForm" (ngSubmit)="submit()">
            <div formArrayName="tasks">
                @for(task of tasks.controls; track task; let i = $index){
                <div [formGroupName]="i" class="px-10">
                    <div>
                        <div class="w-full">
                            <div class="flex justify-between">
                                <p>Task {{i+1}}</p>
                                <div class="flex gap-3">
                                    <div>
                                        <mat-icon (click)="this.moveTask(i, -1)">arrow_upward</mat-icon>
                                        <mat-icon (click)="this.moveTask(i, 1)">arrow_downward</mat-icon>
                                    </div>
                                    <div>
                                        <mat-icon color='danger' (click)="deleteTask(i)">delete_outline</mat-icon>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <mat-form-field floatLabel="always" class="w-full" appearance="outline">
                                <textarea matInput [formControlName]="tasksData.description.name"
                                    [placeholder]="tasksData.description.placeholder"></textarea>
                            </mat-form-field>
                        </div>
                        <div class="sm:flex md:flex lg:flex xl:flex gap-2">
                            <mat-slide-toggle labelPosition="before" color="primary"
                                [formControlName]="tasksData.mandatory.name">
                                {{tasksData.mandatory.label}}
                            </mat-slide-toggle>

                            <mat-slide-toggle labelPosition="before" color="primary"
                                [formControlName]="tasksData.allowEvidence.name">
                                {{tasksData.allowEvidence.label}}
                            </mat-slide-toggle>
                            
                            <div class="border px-2" [ngClass]="{'disable-fileds': !task.get(tasksData?.allowEvidence.name)?.value}" >
                                <mat-select  [formControlName]="tasksData.fileType.name" placeholder="File type">
                                    @for(option of tasksData.fileType.options;track option){
                                    <mat-option [value]="option">
                                        {{ option }}
                                    </mat-option>
                                    }

                                </mat-select>
                            </div>

                            <div class="flex gap-2" [ngClass]="{'disable-fileds': !task.get(tasksData?.allowEvidence.name)?.value}" >
                                <p>{{tasksData.minEvidences.label}}</p>
                                <div class="border">
                                    <input matInput [formControlName]="tasksData.minEvidences.name" placeholder="1"
                                        type="number" min="1"  class="w-16 mt-1 block" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                }

            </div>

            <div class="px-10 py-2">
                <button (click)="addTask()" mat-raised-button class="flex items-center button">
                    <mat-icon class="cursor-pointer" color="primary">add_circle</mat-icon>
                    <span color="primary">Add task</span>
                </button>
            </div>
            <button type="submit">Submit</button>
        </form>
    </div>
</div>